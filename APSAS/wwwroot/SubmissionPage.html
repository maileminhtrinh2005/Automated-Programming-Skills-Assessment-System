<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Online Judge</title>
</head>
<body>
    <h2>Online Judge - Submit & Run Code</h2>

    <!-- Nhập code -->
    <label for="codeArea">Source Code:</label><br />
    <textarea id="codeArea" rows="15" cols="80"></textarea>
    <br /><br />

    <!-- Chọn ngôn ngữ -->
    <label for="languageSelect">Select Language:</label>
    <select id="languageSelect">
        <option value="71">Python (3.8.1)</option>
        <option value="62">Java (OpenJDK 13.0.1)</option>
        <option value="50">C (GCC 9.2.0)</option>
        <option value="54">C++ (GCC 9.2.0)</option>
        <option value="63">JavaScript (Node.js 12.14.0)</option>
        <option value="68">PHP (7.4.1)</option>
    </select>
    <br /><br />

    <!-- Hai nút: Submit và Run -->
    <button onclick="submitCode()">Submit</button>
    <button onclick="runCode()">Run</button>

    <!-- Hiển thị kết quả -->
    <h3>Result:</h3>
    <pre id="result"></pre>

    <script>
        const gatewayUrl = "http://localhost:5261"; // API Gateway URL

        async function submitCode() {
            const body = {
                SourceCode: document.getElementById("codeArea").value,
                LanguageId: parseInt(document.getElementById("languageSelect").value)
            };

            try {
                const res = await fetch(`${gatewayUrl}/Submit`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });

                const data = await res.json();
                document.getElementById("result").innerText = JSON.stringify(data, null, 2);
            } catch (err) {
                document.getElementById("result").innerText = "❌ " + err.message;
            }
        }

        async function runCode() {
            const body = {
                SourceCode: document.getElementById("codeArea").value,
                LanguageId: parseInt(document.getElementById("languageSelect").value)
            };

            try {
                const res = await fetch(`${gatewayUrl}/SubmitAndShow`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });

                if (!res.ok) {
                    throw new Error("Run failed, status " + res.status);
                }

                const result = await res.json();

                // Format kết quả cho dễ đọc
                const formatted = `
🟢 Status: ${result.status}
⏱️ Time: ${result.executionTime}
💾 Memory: ${result.memoryUsed} KB
📤 Output:
${result.output}

⚠️ Error Message:
${result.errorMessage}
                    `;

                document.getElementById("result").innerText = formatted;
            } catch (err) {
                document.getElementById("result").innerText = "❌ " + err.message;
            }
        }
    </script>
</body>
</html>
