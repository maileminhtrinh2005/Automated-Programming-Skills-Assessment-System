<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <title>APSAS Feedback • Tester</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Ngăn trình duyệt gọi /favicon.ico -->
    <link rel="icon" href="data:,">
    <style>
        body {
            font-family: system-ui,Arial;
            background: #f8fafc;
            margin: 28px auto;
            max-width: 920px;
            padding: 20px
        }

        h1 {
            text-align: center;
            color: #2563eb;
            margin: 0 0 8px
        }

        label {
            font-weight: 600;
            display: block;
            margin-top: 12px
        }

        textarea {
            width: 100%;
            padding: 10px;
            margin-top: 6px;
            border-radius: 10px;
            border: 1px solid #cbd5e1;
            font-family: ui-monospace,Menlo,Consolas,monospace;
            min-height: 160px
        }

        .row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 14px 0
        }

        button {
            flex: 1;
            min-width: 140px;
            border: 0;
            border-radius: 10px;
            padding: 12px 14px;
            color: #fff;
            font-weight: 700;
            cursor: pointer
        }

        #btnHealth {
            background: #059669
        }

        #btnSubmit {
            background: #2563eb
        }

        #btnManual {
            background: #7c3aed
        }

        #btnClear {
            background: #dc2626
        }

        pre {
            background: #0b1220;
            color: #e2e8f0;
            padding: 14px;
            border-radius: 12px;
            white-space: pre-wrap;
            word-break: break-word;
            font-size: 14px
        }
    </style>
</head>
<body>
    <h1>APSAS Feedback • Gateway 5261</h1>

    <label>Request Body (POST /feedback/submit)</label>
    <textarea id="body">{
  "studentId": "SV001",
  "assignmentTitle": "Two Sum",
  "rubric": "Đúng 60, Hiệu năng 20, Style 20",
  "sourceCode": "// code của sinh viên...",
  "languageId": 52,
  "testResults": [
    { "name": "Case 1", "status": "Passed", "input": "[2,7,11,15], 9", "expected": "[0,1]", "actual": "[0,1]" },
    { "name": "Case 2", "status": "Failed", "input": "[3,2,4], 6", "expected": "[1,2]", "actual": "[]" }
  ]
}</textarea>

    <div class="row">
        <button id="btnHealth">🩺 GET /feedback/health</button>
        <button id="btnSubmit">📤 POST /feedback/submit</button>
        <button id="btnManual">✍️ POST /feedback/manual</button>
        <button id="btnClear">🗑️ Clear</button>
    </div>

    <label>Kết quả</label>
    <pre id="out">(chưa có kết quả)</pre>

    <script>
        const out = document.querySelector('#out');
        const gw = "http://localhost:5261"; // Cố định Gateway 5261
        const url = p => gw + (p.startsWith('/') ? p : '/' + p);

        async function call(u, m = 'GET', d = null) {
            out.textContent = `${m} ${u}\n...`;
            const o = { method: m, headers: {} };
            if (d) { o.headers['Content-Type'] = 'application/json'; o.body = JSON.stringify(d); }
            try {
                const r = await fetch(u, o);
                const t = await r.text();
                try { out.textContent = `${m} ${u}\nStatus: ${r.status}\n\n` + JSON.stringify(JSON.parse(t), null, 2); }
                catch { out.textContent = `${m} ${u}\nStatus: ${r.status}\n\n${t}`; }
            } catch (e) { out.textContent = `${m} ${u}\nERROR: ${e}`; }
        }

        document.querySelector('#btnHealth').onclick = () => call(url('/feedback/health'));
        document.querySelector('#btnSubmit').onclick = () => {
            try {
                const d = JSON.parse(document.querySelector('#body').value);
                call(url('/feedback/submit'), 'POST', d);
            } catch (e) { out.textContent = '❌ JSON body không hợp lệ: ' + e.message; }
        };
        document.querySelector('#btnManual').onclick = () => {
            const d = { studentId: "SV003", assignmentTitle: "Sorting Algorithm", instructorId: "GV002", score: 85, content: "Bài làm ổn, cần tối ưu thêm." };
            document.querySelector('#body').value = JSON.stringify(d, null, 2);
            call(url('/feedback/manual'), 'POST', d);
        };
        document.querySelector('#btnClear').onclick = () => { document.querySelector('#body').value = ""; out.textContent = "(đã xoá)"; };
    </script>
</body>
</html>
