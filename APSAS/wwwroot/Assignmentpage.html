
Ôªø<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>üß™ Qu·∫£n l√Ω B√†i t·∫≠p</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .hidden {
            display: none;
        }

        form, table, select, button {
            margin: 10px 0;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 5px;
            text-align: left;
        }

        th {
            background-color: #eee;
        }
    </style>
</head>
<body>
    <h2 id="pageTitle">Qu·∫£n l√Ω B√†i t·∫≠p</h2>

    <!-- üîπ Form th√™m b√†i t·∫≠p (·∫©n v·ªõi h·ªçc sinh) -->
    <div id="teacherSection">
        <h3>Th√™m B√†i T·∫≠p M·ªõi</h3>
        <form id="addAssignmentForm">
            <label for="title">Ti√™u ƒë·ªÅ:</label>
            <input type="text" id="title" required>

            <label for="description">M√¥ t·∫£:</label>
            <textarea id="description" rows="3" required></textarea>

            <label for="deadline">H·∫°n n·ªôp:</label>
            <input type="date" id="deadline" required>

            <label for="difficulty">ƒê·ªô kh√≥:</label>
            <select id="difficulty">
                <option value="Easy">D·ªÖ</option>
                <option value="Medium">Trung b√¨nh</option>
                <option value="Hard">Kh√≥</option>
            </select>

            <label for="weight">Tr·ªçng s·ªë (weight):</label>
            <input type="number" id="weight" step="0.1" value="1" required>

            <button type="submit">‚ûï Th√™m B√†i T·∫≠p</button>
        </form>
    </div>

    <!-- üîπ Ph·∫ßn ch·ªçn b√†i t·∫≠p -->
    <div id="assignmentSection">
        <label>Ch·ªçn b√†i t·∫≠p:</label>
        <select id="assignmentSelect"></select>
    </div>

    <!-- üîπ Danh s√°ch test case (·∫©n v·ªõi h·ªçc sinh) -->
    <div id="testcaseSection">
        <h3>Danh s√°ch TestCase</h3>
        <table id="testcaseTable">
            <thead>
                <tr>
                    <th>Input</th>
                    <th>Expected Output</th>
                    <th>Weight</th>
                    <th>X√≥a</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button id="addRowBtn">+ Th√™m d√≤ng</button><br>
        <button id="submitBtn">üì§ G·ª≠i TestCases</button>
    </div>

    <pre id="result"></pre>

    <script>
        const baseUrl = "http://localhost:5261";

        // üîπ Gi·∫£ l·∫≠p role (t·∫°m set c·ª©ng)
        const role = "Student"; // üëâ ƒë·ªïi sang "Teacher" ƒë·ªÉ test ch·ª©c nƒÉng gi√°o vi√™n
        //const role = "Teacher";

        // üîπ ·∫®n hi·ªán c√°c ph·∫ßn theo role
        function setupUIByRole() {
            const teacherSection = document.getElementById("teacherSection");
            const testcaseSection = document.getElementById("testcaseSection");

            if (role === "Teacher") {
                teacherSection.classList.remove("hidden");
                testcaseSection.classList.remove("hidden");
                document.getElementById("pageTitle").textContent = "üë®‚Äçüè´ Qu·∫£n l√Ω B√†i t·∫≠p (Gi√°o vi√™n)";
            } else {
                teacherSection.classList.add("hidden");
                testcaseSection.classList.add("hidden");
                document.getElementById("pageTitle").textContent = "üë©‚Äçüéì Danh s√°ch B√†i t·∫≠p (H·ªçc sinh)";
            }
        }

        // üîπ Load danh s√°ch b√†i t·∫≠p
        async function loadAssignments() {
            const res = await fetch(`${baseUrl}/GetAllAssignment`);
            const data = await res.json();
            const select = document.getElementById("assignmentSelect");

            data.forEach(a => {
                const opt = document.createElement("option");
                opt.value = a.assignmentId;
                opt.textContent = `${a.assignmentId} - ${a.title}`;
                select.appendChild(opt);
            });

            // N·∫øu l√† h·ªçc sinh ‚Üí b·∫•m ch·ªçn b√†i t·∫≠p ƒë·ªÉ xem chi ti·∫øt
            if (role === "Student") {
                select.addEventListener("change", () => {
                    const selectedId = select.value;
                    if (selectedId) {
                        // L∆∞u ID v√†o localStorage
                        localStorage.setItem("selectedAssignmentId", selectedId);
                        // Chuy·ªÉn qua trang xem b√†i t·∫≠p
                        window.location.href = `SubmissionPage.html?id=${selectedId}`;

                    }
                });
            }
        }

        // üîπ Th√™m d√≤ng TestCase (ch·ªâ d√†nh cho gi√°o vi√™n)
        document.getElementById("addRowBtn").addEventListener("click", () => {
            const tbody = document.querySelector("#testcaseTable tbody");
            const row = document.createElement("tr");

            row.innerHTML = `
        <td><textarea placeholder="V√≠ d·ª•: 1 2 ho·∫∑c 1‚Üµ2" rows="2" style="width:100%;"></textarea></td>
        <td><textarea placeholder="V√≠ d·ª•: 3" rows="1" style="width:100%;"></textarea></td>
        <td><input type="number" step="0.1" value="1" style="width:60px;"></td>
        <td><button class="removeBtn">‚ùå</button></td>
    `;
            row.querySelector(".removeBtn").addEventListener("click", () => row.remove());
            tbody.appendChild(row);
        });

        // üîπ G·ª≠i TestCase
        document.getElementById("submitBtn").addEventListener("click", async () => {
            const assignmentId = document.getElementById("assignmentSelect").value;
            const rows = document.querySelectorAll("#testcaseTable tbody tr");

            const testCaseItems = Array.from(rows).map(r => ({
                input: r.children[0].querySelector("textarea").value.trim(),
                expectedOutput: r.children[1].querySelector("textarea").value.trim(),
                weight: parseFloat(r.children[2].querySelector("input").value)
            }));


            const payload = {
                assiginmentId: parseInt(assignmentId),
                testCaseItems: testCaseItems
            };

            const res = await fetch(`${baseUrl}/AddTestCase`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const text = await res.text();
            document.getElementById("result").textContent = res.ok ? `‚úÖ ${text}` : `‚ùå ${text}`;
        });

        // üîπ Th√™m b√†i t·∫≠p (ch·ªâ gi√°o vi√™n d√πng)
        document.getElementById("addAssignmentForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            const data = {
                title: document.getElementById("title").value,
                description: document.getElementById("description").value,
                deadline: document.getElementById("deadline").value,
                difficulty: document.getElementById("difficulty").value,
                weight: parseFloat(document.getElementById("weight").value)
            };

            const res = await fetch(`${baseUrl}/AddAssignment`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                alert("‚úÖ Th√™m b√†i t·∫≠p th√†nh c√¥ng!");
                loadAssignments(); // reload list
            } else {
                alert("‚ùå Th√™m b√†i t·∫≠p th·∫•t b·∫°i!");
            }
        });

        // üîπ G·ªçi khi trang m·ªü
        setupUIByRole();
        loadAssignments();
    </script>
</body>
</html>

