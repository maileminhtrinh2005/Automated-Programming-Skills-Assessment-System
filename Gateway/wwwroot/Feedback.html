<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <title>APSAS Feedback Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            font-family: system-ui, Arial;
            background: #f8fafc;
            margin: 30px auto;
            max-width: 900px;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #2563eb;
        }

        label {
            font-weight: 600;
            display: block;
            margin-top: 12px;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin-top: 6px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-family: monospace;
        }

        textarea {
            min-height: 140px;
            resize: vertical;
        }

        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        button {
            flex: 1;
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: white;
        }

            button:hover {
                opacity: 0.9;
            }

        #btnHealth {
            background: #059669;
        }

        #btnSubmit {
            background: #2563eb;
        }

        #btnManual {
            background: #9333ea;
        }

        #btnClear {
            background: #dc2626;
        }

        pre {
            background: #0f172a;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 10px;
            white-space: pre-wrap;
            font-size: 14px;
            margin-top: 10px;
        }

        .small {
            color: #64748b;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <h1>APSAS Feedback • API Test</h1>

    <label>Gateway Base URL</label>
    <input id="base" value="http://localhost:5141" />
    <div class="small">VD: Gateway 5141 → map xuống Service 5216</div>

    <label>Request Body (cho POST)</label>
    <textarea id="body">{
  "studentId": "SV001",
  "assignmentTitle": "Two Sum",
  "rubric": "Đúng 60, Hiệu năng 20, Style 20",
  "sourceCode": "// code của sinh viên...",
  "languageId": 52,
  "testResults": [
    { "name": "Case 1", "status": "Passed", "input": "[2,7,11,15], 9", "actual": "[0,1]" },
    { "name": "Case 2", "status": "Failed", "input": "[3,2,4], 6", "expected": "[1,2]", "actual": "[]" }
  ]
}</textarea>

    <div class="btn-row">
        <button id="btnHealth">🩺 Health</button>
        <button id="btnSubmit">📤 Submit</button>
        <button id="btnManual">✍️ Manual</button>
        <button id="btnClear">🗑️ Clear</button>
    </div>

    <label>Kết quả</label>
    <pre id="out">(chưa có kết quả)</pre>

    <script>
        const $ = s => document.querySelector(s);
        const out = $('#out'), base = $('#base'), body = $('#body');

        async function callApi(url, method = 'GET', data = null) {
            out.textContent = `${method} ${url}\n...`;
            const opts = { method };
            if (data) {
                opts.headers = { 'Content-Type': 'application/json' };
                opts.body = JSON.stringify(data);
            }
            try {
                const res = await fetch(url, opts);
                const text = await res.text();
                try { out.textContent = `${method} ${url}\nStatus: ${res.status}\n\n${JSON.stringify(JSON.parse(text), null, 2)}`; }
                catch { out.textContent = `${method} ${url}\nStatus: ${res.status}\n\n${text}`; }
            } catch (e) {
                out.textContent = `${method} ${url}\nERROR: ${e}`;
            }
        }

        $('#btnHealth').onclick = () => {
            callApi(base.value.replace(/\/+$/, '') + '/feedback/health');
        };

        $('#btnSubmit').onclick = () => {
            try {
                const data = JSON.parse(body.value);
                callApi(base.value.replace(/\/+$/, '') + '/feedback/submit', 'POST', data);
            } catch (e) {
                out.textContent = '❌ JSON body không hợp lệ: ' + e.message;
            }
        };

        $('#btnManual').onclick = () => {
            const manual = {
                studentId: "SV003",
                assignmentTitle: "Sorting Algorithm",
                instructorId: "GV002",
                score: 85,
                content: "Bài làm ổn, cần tối ưu thêm thuật toán và xử lý input âm."
            };
            body.value = JSON.stringify(manual, null, 2);
            callApi(base.value.replace(/\/+$/, '') + '/feedback/manual', 'POST', manual);
        };

        $('#btnClear').onclick = () => {
            body.value = "";
            out.textContent = "(đã xoá)";
        };
    </script>
</body>
</html>
